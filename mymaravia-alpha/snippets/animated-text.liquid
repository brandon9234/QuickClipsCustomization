{%- assign text = animated-text -%}
{%- if text contains '[' and text contains ']' and text contains '|' -%}
  <lazy-script src="{{ 'animated-list.js' | asset_url }}" defer="defer"></lazy-script>
  {%- liquid
    assign before_bracket = text | split: "[" | first
    assign inside_bracket = text | split: "[" | last | split: "]" | first
    assign after_bracket = text | split: "]" | last

    assign inside_em = inside_bracket | split: "<em>" | last | split: "</em>" | first
    assign inside_strong = inside_bracket | split: "<strong>" | last | split: "</strong>" | first

    assign items = inside_bracket | split: "|"
    assign first_item = items | first
    assign remaining_items = items | slice: 1, items.size | join: "|"
  -%}

  {%- if inside_bracket contains '<em>' and inside_em contains '|' -%}
    {{ text | replace: '++', '<br>' }}
  {%- elsif inside_bracket contains '<strong>' and inside_strong contains '|' -%}
    {{ text | replace: '++', '<br>' }}
  {%- else -%}
    {{- before_bracket | replace: '++', '<br>' -}}
    <animated-list class="relative inline-flex" data-list="{{ remaining_items }}">{{ first_item }}</animated-list>
    {%- unless after_bracket contains '[' -%}{{ after_bracket | replace: '++', '<br>' }}{%- endunless -%}
  {%- endif -%}
{%- else -%}
  {{ text | replace: '++', '<br>' }}
{%- endif -%}